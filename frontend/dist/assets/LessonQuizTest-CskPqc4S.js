import{c as u,f as K,d as Z,a as tt,j as e,B as et,H as st}from"./index-BduiCrXO.js";import{A as rt}from"./Alert-BFgIc0FV.js";import{H as at}from"./HomeworkIcon-o51Ry-an.js";/* empty css                         *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var E=function(t,r){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var o in a)a.hasOwnProperty(o)&&(s[o]=a[o])},E(t,r)};function nt(t,r){E(t,r);function s(){this.constructor=t}t.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}var ot=100,it=100,A=50,P=50,I=50;function V(t){var r=t.className,s=t.counterClockwise,a=t.dashRatio,o=t.pathRadius,c=t.strokeWidth,h=t.style;return u.createElement("path",{className:r,style:Object.assign({},h,lt({pathRadius:o,dashRatio:a,counterClockwise:s})),d:ct({pathRadius:o,counterClockwise:s}),strokeWidth:c,fillOpacity:0})}function ct(t){var r=t.pathRadius,s=t.counterClockwise,a=r,o=s?1:0;return`
      M `+P+","+I+`
      m 0,-`+a+`
      a `+a+","+a+" "+o+" 1 1 0,"+2*a+`
      a `+a+","+a+" "+o+" 1 1 0,-"+2*a+`
    `}function lt(t){var r=t.counterClockwise,s=t.dashRatio,a=t.pathRadius,o=Math.PI*2*a,c=(1-s)*o;return{strokeDasharray:o+"px "+o+"px",strokeDashoffset:(r?-c:c)+"px"}}var ut=function(t){nt(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},r.prototype.getPathRadius=function(){return A-this.props.strokeWidth/2-this.getBackgroundPadding()},r.prototype.getPathRatio=function(){var s=this.props,a=s.value,o=s.minValue,c=s.maxValue,h=Math.min(Math.max(a,o),c);return(h-o)/(c-o)},r.prototype.render=function(){var s=this.props,a=s.circleRatio,o=s.className,c=s.classes,h=s.counterClockwise,p=s.styles,x=s.strokeWidth,v=s.text,l=this.getPathRadius(),m=this.getPathRatio();return u.createElement("svg",{className:c.root+" "+o,style:p.root,viewBox:"0 0 "+ot+" "+it,"data-test-id":"CircularProgressbar"},this.props.background?u.createElement("circle",{className:c.background,style:p.background,cx:P,cy:I,r:A}):null,u.createElement(V,{className:c.trail,counterClockwise:h,dashRatio:a,pathRadius:l,strokeWidth:x,style:p.trail}),u.createElement(V,{className:c.path,counterClockwise:h,dashRatio:m*a,pathRadius:l,strokeWidth:x,style:p.path}),v?u.createElement("text",{className:c.text,style:p.text,x:P,y:I},v):null)},r.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},r}(u.Component);function dt(t){var r=t.rotation,s=t.strokeLinecap,a=t.textColor,o=t.textSize,c=t.pathColor,h=t.pathTransition,p=t.pathTransitionDuration,x=t.trailColor,v=t.backgroundColor,l=r==null?void 0:"rotate("+r+"turn)",m=r==null?void 0:"center center";return{root:{},path:N({stroke:c,strokeLinecap:s,transform:l,transformOrigin:m,transition:h,transitionDuration:p==null?void 0:p+"s"}),trail:N({stroke:x,strokeLinecap:s,transform:l,transformOrigin:m}),text:N({fill:a,fontSize:o}),background:N({fill:v})}}function N(t){return Object.keys(t).forEach(function(r){t[r]==null&&delete t[r]}),t}function gt({user:t,setShowLoadScreen:r}){var T;const{courseId:s,lessonId:a}=K(),o=Z(),{data:c,loading:h,error:p,setData:x,setLoading:v}=tt(),[l,m]=u.useState(null),[B,H]=u.useState(null),[C,D]=u.useState(0),[w,q]=u.useState(null),[b,z]=u.useState(!1),[y,L]=u.useState(0),[_,$]=u.useState(!1),[O,M]=u.useState(!1),[Q,W]=u.useState(!1),[X,S]=u.useState(!1),[R,F]=u.useState([]);u.useEffect(()=>{var n,i,f;if(!h&&c){const d=(n=c.courses)==null?void 0:n.find(j=>String(j.id)===s),g=(i=d==null?void 0:d.lessons)==null?void 0:i.find(j=>String(j.id)===a);H(g),(f=g==null?void 0:g.quizzes)!=null&&f.length?m(g.quizzes[0]):m(null)}},[h,c,s,a]);const G=n=>{b||q(n)},U=()=>{if(w==null)return;z(!0);const n=l.questions[C].answers.find(i=>i.id===w);n!=null&&n.correct&&L(i=>i+1),M(!!(n!=null&&n.correct)),F(i=>[...i,{questionId:l.questions[C].id,answerId:w}])},J=()=>{C+1>=l.questions.length?$(!0):(D(n=>n+1),q(null),z(!1))},Y=()=>{S(!0);const n=l.questions.length,i=Math.round(y/n*100),f=t!=null&&t.id?t.id:0;fetch("/api/save_attempt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:f,quizId:l.id,courseId:s,progress:i,answers:R})}).then(d=>{if(!d.ok)throw new Error("Ошибка сети");return fetch(`/api/get_app_data?user_id=${f}`)}).then(d=>{if(!d.ok)throw new Error("Ошибка загрузки данных");return d.json()}).then(d=>{x(d),S(!1),o(`/lessons/${s}`)}).catch(d=>{W(!0),console.error("Ошибка сохранения попытки:",d),setTimeout(()=>{S(!1),W(!1),o(`/lessons/${s}`)},2e3)})};if(h)return e.jsx("div",{children:"Загрузка..."});if(p)return e.jsxs("div",{className:"lesson-quiz error",children:["Ошибка: ",p]});if(!l)return e.jsx("div",{className:"lesson-quiz",children:"Тест не найден"});if(_){const n=l.questions.length,i=Math.round(y/n*100);return e.jsxs("div",{className:"quiz",children:[Q&&e.jsx(rt,{text:"Не удалось сохранить прогресс"}),e.jsx("h1",{children:"Результаты теста"}),e.jsx("div",{className:"results-circle",children:e.jsx(ut,{value:i,text:`${i}%`,styles:dt({pathColor:i>=70?"var(--success)":"var(--danger)",textColor:"var(--white)",trailColor:"#eee",backgroundColor:"var(--white)"})})}),e.jsxs("div",{className:"quiz-footer",children:[e.jsxs("div",{className:"results",children:[e.jsxs("p",{className:"correct",children:["Правильные ответы: ",y]}),e.jsxs("p",{className:"incorrect",children:["Неправильные ответы: ",n-y]})]}),e.jsx(et,{type:"btn btn-accent btn-p12",onClick:Y,text:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Завершение..."]}):"Завершить тест"})]})]})}const k=(l==null?void 0:l.questions)&&l.questions[C];return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"quiz",children:[e.jsxs("div",{children:[e.jsx(st,{title:e.jsxs("div",{children:[" Домашнее задание по уроку: ",e.jsx("br",{})," ",B.title," "]}),svg:e.jsx(at,{})}),e.jsxs("div",{className:"quiz-question",children:[e.jsx("div",{className:"progress-bar",children:l.questions.map((n,i)=>{let f="";if(i<R.length){const d=R[i],g=n.answers.find(j=>j.correct);f=d.answerId===g.id?"correct":"incorrect"}return e.jsx("div",{className:`progress-segment ${f}`},n.id)})}),e.jsxs("p",{className:"question-count",children:["Вопрос ",C+1," из ",l.questions.length]}),e.jsx("h2",{children:k==null?void 0:k.text}),e.jsx("div",{className:"quiz-answers",children:(T=k==null?void 0:k.answers)==null?void 0:T.map(n=>{const i=w===n.id,f=b?n.correct?"correct":i?"incorrect":"":"";return e.jsxs("label",{className:`quiz-answer ${f}`,children:[e.jsx("input",{type:"radio",name:"answer",checked:i,onChange:()=>G(n.id),disabled:b}),n.text]},n.id)})})]})]}),e.jsx("div",{className:"actions",children:b?e.jsx("button",{className:`btn btn-p12 ${O?"btn-correct":"btn-incorrect"}`,onClick:J,children:O?"Правильно! К следующему":"Неправильно! К следующему"}):e.jsx("button",{className:"btn btn-p12",onClick:U,disabled:w==null,children:"Проверить"})})]})})}export{gt as default};
