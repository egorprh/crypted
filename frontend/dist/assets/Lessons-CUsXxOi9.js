import{d as N,f as v,a as w,c as o,j as s,L as I,H as T,e as L,A as C}from"./index-Oq4_Z5Dz.js";import{B as S}from"./BackIcon-BsHs6U-H.js";import{h as $}from"./handleImageError-DYzZusFE.js";import{C as y}from"./ContentNotFound-CFBuExWZ.js";import{L as E}from"./LockIcon-CJ8_vXoD.js";import{T as R}from"./TImerIcon-CJLmtLYG.js";function _({user:t}){const p=N(),{courseId:i}=v(),{data:n,loading:d,error:l}=w(),[c,m]=o.useState([]),[h,u]=o.useState(""),[f,x]=o.useState(""),[r,k]=o.useState([]),g=(t==null?void 0:t.id)||0,b=e=>{fetch("/api/lesson_viewed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lessonId:e.id,userId:g})}).catch(a=>{console.error("Ошибка при отправке события просмотра урока:",a)}),p(`/lessons/${i}/${e.id}/content`)};return o.useEffect(()=>{if(!d&&n){const a=(n.courses||[]).find(j=>String(j.id)===i);a?(u(a.title),x(a.description),k(a.access_time),m(a.lessons)):(console.warn("Курс не найден"),m([]),u(""),x(""))}},[n,d,i]),l?s.jsxs("div",{className:"error",children:["Ошибка: ",l]}):s.jsxs("div",{className:"page-container content",children:[s.jsxs("div",{className:"back-link-wrapper",children:[s.jsxs(I,{to:"/",className:"back-link",children:[s.jsx(S,{}),"Назад"]}),r!=null&&r!==-1&&s.jsx("div",{className:"access-timer",children:s.jsxs("div",{className:"access-timer-count",children:[s.jsx(R,{}),(()=>{const e=Math.ceil(r/24),a=new Intl.PluralRules("ru-RU");return`${e} ${{one:"день",few:"дня",many:"дней",other:"дня"}[a.select(e)]}`})()]})})]}),s.jsxs("div",{className:"welcome",children:[s.jsx(T,{title:h,svg:s.jsx(L,{})}),s.jsx("p",{className:"text-gray-300",children:f})]}),c!=null&&c.length?c==null?void 0:c.map((e,a)=>s.jsxs("div",{className:`lesson-block ${e.blocked?"lesson-block--blocked":""}`,children:[s.jsxs("div",{className:`badge lesson-badge ${e.blocked?"lesson-badge--blocked":""}`,children:["Урок ",a+1]}),s.jsxs("div",{className:`lesson-card ${e.blocked?"lesson-card--blocked":""}`,onClick:()=>!e.blocked&&b(e),children:[s.jsxs("div",{className:"info",children:[s.jsxs("div",{className:e.duration?"info-wrapper":"",children:[s.jsx("img",{src:e.image||"/images/default-event.png",alt:"",onError:$()}),e.duration&&s.jsx("span",{className:"lesson-duration",children:e.duration})]}),s.jsx("span",{className:e.blocked?"lesson-title--blocked":"",children:e.blocked?"Доступно после прохождения предыдущего урока":e.title})]}),s.jsx("div",{className:"arrow",children:e.blocked?s.jsx(E,{}):s.jsx(C,{})})]})]},e.id)):s.jsx(y,{message:"Уроки не найдены"})]})}export{_ as default};
