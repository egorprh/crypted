import{r as u,e as U,c as J,a as Y,j as s,H as K}from"./index-aXoLR3lU.js";/* empty css                         */import{A as Z}from"./Alert-3kB1lq8t.js";import{H as tt}from"./HomeworkIcon-DwYgt8Nv.js";/* empty css              *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var R=function(t,e){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])},R(t,e)};function et(t,e){R(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var st=100,rt=100,T=50,E=50,P=50;function A(t){var e=t.className,r=t.counterClockwise,a=t.dashRatio,o=t.pathRadius,c=t.strokeWidth,h=t.style;return u.createElement("path",{className:e,style:Object.assign({},h,nt({pathRadius:o,dashRatio:a,counterClockwise:r})),d:at({pathRadius:o,counterClockwise:r}),strokeWidth:c,fillOpacity:0})}function at(t){var e=t.pathRadius,r=t.counterClockwise,a=e,o=r?1:0;return`
      M `+E+","+P+`
      m 0,-`+a+`
      a `+a+","+a+" "+o+" 1 1 0,"+2*a+`
      a `+a+","+a+" "+o+" 1 1 0,-"+2*a+`
    `}function nt(t){var e=t.counterClockwise,r=t.dashRatio,a=t.pathRadius,o=Math.PI*2*a,c=(1-r)*o;return{strokeDasharray:o+"px "+o+"px",strokeDashoffset:(e?-c:c)+"px"}}var ot=function(t){et(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},e.prototype.getPathRadius=function(){return T-this.props.strokeWidth/2-this.getBackgroundPadding()},e.prototype.getPathRatio=function(){var r=this.props,a=r.value,o=r.minValue,c=r.maxValue,h=Math.min(Math.max(a,o),c);return(h-o)/(c-o)},e.prototype.render=function(){var r=this.props,a=r.circleRatio,o=r.className,c=r.classes,h=r.counterClockwise,p=r.styles,x=r.strokeWidth,l=r.text,m=this.getPathRadius(),k=this.getPathRatio();return u.createElement("svg",{className:c.root+" "+o,style:p.root,viewBox:"0 0 "+st+" "+rt,"data-test-id":"CircularProgressbar"},this.props.background?u.createElement("circle",{className:c.background,style:p.background,cx:E,cy:P,r:T}):null,u.createElement(A,{className:c.trail,counterClockwise:h,dashRatio:a,pathRadius:m,strokeWidth:x,style:p.trail}),u.createElement(A,{className:c.path,counterClockwise:h,dashRatio:k*a,pathRadius:m,strokeWidth:x,style:p.path}),l?u.createElement("text",{className:c.text,style:p.text,x:E,y:P},l):null)},e.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},e}(u.Component);function it(t){var e=t.rotation,r=t.strokeLinecap,a=t.textColor,o=t.textSize,c=t.pathColor,h=t.pathTransition,p=t.pathTransitionDuration,x=t.trailColor,l=t.backgroundColor,m=e==null?void 0:"rotate("+e+"turn)",k=e==null?void 0:"center center";return{root:{},path:b({stroke:c,strokeLinecap:r,transform:m,transformOrigin:k,transition:h,transitionDuration:p==null?void 0:p+"s"}),trail:b({stroke:x,strokeLinecap:r,transform:m,transformOrigin:k}),text:b({fill:a,fontSize:o}),background:b({fill:l})}}function b(t){return Object.keys(t).forEach(function(e){t[e]==null&&delete t[e]}),t}function pt({user:t}){var W;const{courseId:e,lessonId:r}=U(),a=J(),{data:o,loading:c,error:h,setData:p,setLoading:x}=Y(),[l,m]=u.useState(null),[k,V]=u.useState(null),[C,H]=u.useState(0),[w,I]=u.useState(null),[y,q]=u.useState(!1),[N,D]=u.useState(0),[B,L]=u.useState(!1),[z,_]=u.useState(!1),[$,O]=u.useState(!1),[S,M]=u.useState([]);u.useEffect(()=>{var n,i,f;if(!c&&o){const d=(n=o.courses)==null?void 0:n.find(j=>String(j.id)===e),g=(i=d==null?void 0:d.lessons)==null?void 0:i.find(j=>String(j.id)===r);V(g),(f=g==null?void 0:g.quizzes)!=null&&f.length?m(g.quizzes[0]):m(null)}},[c,o,e,r]);const Q=n=>{y||I(n)},X=()=>{if(w==null)return;q(!0);const n=l.questions[C].answers.find(i=>i.id===w);n!=null&&n.correct&&D(i=>i+1),_(!!(n!=null&&n.correct)),M(i=>[...i,{questionId:l.questions[C].id,answerId:w}])},F=()=>{C+1>=l.questions.length?L(!0):(H(n=>n+1),I(null),q(!1))},G=()=>{const n=l.questions.length,i=Math.round(N/n*100),f=t!=null&&t.id?t.id:0;fetch("/api/save_attempt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:f,quizId:l.id,courseId:e,progress:i,answers:S})}).then(d=>{if(!d.ok)throw new Error("Ошибка сети");return fetch(`/api/get_app_data?user_id=${f}`)}).then(d=>{if(!d.ok)throw new Error("Ошибка загрузки данных");return d.json()}).then(d=>{p(d),x(!1),a(`/lessons/${e}`)}).catch(d=>{O(!0),console.error("Ошибка сохранения попытки:",d),setTimeout(()=>{O(!1),a(`/lessons/${e}`)},2e3)})};if(c)return s.jsx("div",{children:"Загрузка..."});if(h)return s.jsxs("div",{className:"lesson-quiz error",children:["Ошибка: ",h]});if(!l)return s.jsx("div",{className:"lesson-quiz",children:"Тест не найден"});if(B){const n=l.questions.length,i=Math.round(N/n*100);return s.jsxs("div",{className:"quiz",children:[$&&s.jsx(Z,{text:"Не удалось сохранить прогресс"}),s.jsx("h1",{children:"Результаты теста"}),s.jsx("div",{className:"results-circle",children:s.jsx(ot,{value:i,text:`${i}%`,styles:it({pathColor:i>=70?"var(--success)":"var(--danger)",textColor:"var(--white)",trailColor:"#eee",backgroundColor:"var(--white)"})})}),s.jsxs("div",{className:"quiz-footer",children:[s.jsxs("div",{className:"results",children:[s.jsxs("p",{className:"correct",children:["Правильные ответы: ",N]}),s.jsxs("p",{className:"incorrect",children:["Неправильные ответы: ",n-N]})]}),s.jsx("button",{className:"btn",onClick:G,children:"Завершить тест"})]})]})}const v=(l==null?void 0:l.questions)&&l.questions[C];return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"quiz",children:[s.jsxs("div",{children:[s.jsx(K,{title:s.jsxs("div",{children:[" Домашнее задание по уроку: ",s.jsx("br",{})," ",k.title," "]}),svg:s.jsx(tt,{})}),s.jsxs("div",{className:"quiz-question",children:[s.jsx("div",{className:"progress-bar",children:l.questions.map((n,i)=>{let f="";if(i<S.length){const d=S[i],g=n.answers.find(j=>j.correct);f=d.answerId===g.id?"correct":"incorrect"}return s.jsx("div",{className:`progress-segment ${f}`},n.id)})}),s.jsxs("p",{className:"question-count",children:["Вопрос ",C+1," из ",l.questions.length]}),s.jsx("h2",{children:v==null?void 0:v.text}),s.jsx("div",{className:"quiz-answers",children:(W=v==null?void 0:v.answers)==null?void 0:W.map(n=>{const i=w===n.id,f=y?n.correct?"correct":i?"incorrect":"":"";return s.jsxs("label",{className:`quiz-answer ${f}`,children:[s.jsx("input",{type:"radio",name:"answer",checked:i,onChange:()=>Q(n.id),disabled:y}),n.text]},n.id)})})]})]}),s.jsx("div",{className:"actions",children:y?s.jsx("button",{className:`btn ${z?"btn-correct":"btn-incorrect"}`,onClick:F,children:z?"Правильно! К следующему":"Неправильно! К следующему"}):s.jsx("button",{className:"btn",onClick:X,disabled:w==null,children:"Проверить"})})]})})}export{pt as default};
