import{c as u,f as st,d as rt,a as nt,j as e,B as at,H as ot}from"./index-cSVua3Tt.js";import{A as it}from"./Alert-C9chRO6Y.js";import{H as ct}from"./HomeworkIcon-B_Qb7mhR.js";/* empty css                         *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var P=function(t,r){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var o in a)a.hasOwnProperty(o)&&(s[o]=a[o])},P(t,r)};function lt(t,r){P(t,r);function s(){this.constructor=t}t.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}var ut=100,dt=100,_=50,I=50,T=50;function D(t){var r=t.className,s=t.counterClockwise,a=t.dashRatio,o=t.pathRadius,d=t.strokeWidth,p=t.style;return u.createElement("path",{className:r,style:Object.assign({},p,pt({pathRadius:o,dashRatio:a,counterClockwise:s})),d:ht({pathRadius:o,counterClockwise:s}),strokeWidth:d,fillOpacity:0})}function ht(t){var r=t.pathRadius,s=t.counterClockwise,a=r,o=s?1:0;return`
      M `+I+","+T+`
      m 0,-`+a+`
      a `+a+","+a+" "+o+" 1 1 0,"+2*a+`
      a `+a+","+a+" "+o+" 1 1 0,-"+2*a+`
    `}function pt(t){var r=t.counterClockwise,s=t.dashRatio,a=t.pathRadius,o=Math.PI*2*a,d=(1-s)*o;return{strokeDasharray:o+"px "+o+"px",strokeDashoffset:(r?-d:d)+"px"}}var mt=function(t){lt(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},r.prototype.getPathRadius=function(){return _-this.props.strokeWidth/2-this.getBackgroundPadding()},r.prototype.getPathRatio=function(){var s=this.props,a=s.value,o=s.minValue,d=s.maxValue,p=Math.min(Math.max(a,o),d);return(p-o)/(d-o)},r.prototype.render=function(){var s=this.props,a=s.circleRatio,o=s.className,d=s.classes,p=s.counterClockwise,f=s.styles,C=s.strokeWidth,w=s.text,c=this.getPathRadius(),v=this.getPathRatio();return u.createElement("svg",{className:d.root+" "+o,style:f.root,viewBox:"0 0 "+ut+" "+dt,"data-test-id":"CircularProgressbar"},this.props.background?u.createElement("circle",{className:d.background,style:f.background,cx:I,cy:T,r:_}):null,u.createElement(D,{className:d.trail,counterClockwise:p,dashRatio:a,pathRadius:c,strokeWidth:C,style:f.trail}),u.createElement(D,{className:d.path,counterClockwise:p,dashRatio:v*a,pathRadius:c,strokeWidth:C,style:f.path}),w?u.createElement("text",{className:d.text,style:f.text,x:I,y:T},w):null)},r.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},r}(u.Component);function xt(t){var r=t.rotation,s=t.strokeLinecap,a=t.textColor,o=t.textSize,d=t.pathColor,p=t.pathTransition,f=t.pathTransitionDuration,C=t.trailColor,w=t.backgroundColor,c=r==null?void 0:"rotate("+r+"turn)",v=r==null?void 0:"center center";return{root:{},path:N({stroke:d,strokeLinecap:s,transform:c,transformOrigin:v,transition:p,transitionDuration:f==null?void 0:f+"s"}),trail:N({stroke:C,strokeLinecap:s,transform:c,transformOrigin:v}),text:N({fill:a,fontSize:o}),background:N({fill:w})}}function N(t){return Object.keys(t).forEach(function(r){t[r]==null&&delete t[r]}),t}function kt({user:t,setShowLoadScreen:r}){var L,B;const{courseId:s,lessonId:a}=st(),o=rt(),{data:d,loading:p,error:f,setData:C,setLoading:w}=nt(),[c,v]=u.useState(null),[Q,M]=u.useState(null),[b,$]=u.useState(0),[j,z]=u.useState(null),[y,A]=u.useState(""),[k,S]=u.useState(!1),[O,X]=u.useState(0),[F,G]=u.useState(!1),[W,q]=u.useState(!1),[U,V]=u.useState(!1),[J,E]=u.useState(!1),[R,H]=u.useState([]);u.useEffect(()=>{var n,i,l;if(!p&&d){const g=(n=d.courses)==null?void 0:n.find(h=>String(h.id)===s),x=(i=g==null?void 0:g.lessons)==null?void 0:i.find(h=>String(h.id)===a);M(x),(l=x==null?void 0:x.quizzes)!=null&&l.length?v(x.quizzes[0]):v(null)}},[p,d,s,a]);const Y=n=>{k||z(n)},K=n=>{if(k)return;const i=n.target.value;i.length<=512&&A(i)},Z=()=>{document.activeElement&&document.activeElement.blur();const n=c.questions[b];if(n.type==="text"){if(!y.trim())return;S(!0),q(!0),H(i=>[...i,{questionId:n.id,answerText:y.trim()}])}else{if(j==null)return;S(!0);const i=n.answers.find(l=>l.id===j);i!=null&&i.correct&&X(l=>l+1),q(!!(i!=null&&i.correct)),H(l=>[...l,{questionId:n.id,answerId:j}])}},tt=()=>{document.activeElement&&document.activeElement.blur(),b+1>=c.questions.length?G(!0):($(n=>n+1),z(null),A(""),S(!1))},et=()=>{E(!0);const n=c.questions.length,i=c.questions.filter(h=>h.type==="text").length,l=O+i,g=Math.round(l/n*100),x=t!=null&&t.id?t.id:0;fetch("/api/save_attempt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x,quizId:c.id,courseId:s,progress:g,answers:R})}).then(h=>{if(!h.ok)throw new Error("Ошибка сети");return fetch(`/api/get_app_data?user_id=${x}`)}).then(h=>{if(!h.ok)throw new Error("Ошибка загрузки данных");return h.json()}).then(h=>{C(h),E(!1),o(`/lessons/${s}`)}).catch(h=>{V(!0),console.error("Ошибка сохранения попытки:",h),setTimeout(()=>{E(!1),V(!1),o(`/lessons/${s}`)},2e3)})};if(p)return e.jsx("div",{children:"Загрузка..."});if(f)return e.jsxs("div",{className:"lesson-quiz error",children:["Ошибка: ",f]});if(!c)return e.jsx("div",{className:"lesson-quiz",children:"Тест не найден"});if(F){const n=c.questions.length,i=c.questions.filter(x=>x.type==="text").length,l=O+i,g=Math.round(l/n*100);return e.jsxs("div",{className:"quiz",children:[U&&e.jsx(it,{text:"Не удалось сохранить прогресс"}),e.jsx("h1",{children:"Результаты теста"}),e.jsx("div",{className:"results-circle",children:e.jsx(mt,{value:g,text:`${g}%`,styles:xt({pathColor:g>=70?"var(--success)":"var(--danger)",textColor:"var(--white)",trailColor:"#eee",backgroundColor:"var(--white)"})})}),e.jsxs("div",{className:"quiz-footer",children:[e.jsxs("div",{className:"results",children:[e.jsxs("p",{className:"correct",children:["Правильные ответы: ",l]}),e.jsxs("p",{className:"incorrect",children:["Неправильные ответы: ",n-l]})]}),e.jsx(at,{type:"btn btn-accent btn-p12",onClick:et,text:J?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Завершение..."]}):"Завершить тест"})]})]})}const m=(c==null?void 0:c.questions)&&c.questions[b];return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"quiz",children:[e.jsxs("div",{children:[e.jsx(ot,{title:e.jsxs("div",{children:[" Домашка по уроку: ",e.jsx("br",{})," ",e.jsx("span",{className:"quiz-lesson-title",children:Q.title})," "]}),svg:e.jsx(ct,{})}),e.jsxs("div",{className:"quiz-question",children:[e.jsx("div",{className:"progress-bar",children:c.questions.map((n,i)=>{let l="";if(i<R.length){const g=R[i];if(n.type==="text")l="correct";else{const x=n.answers.find(h=>h.correct);l=g.answerId===x.id?"correct":"incorrect"}}return e.jsx("div",{className:`progress-segment ${l}`},n.id)})}),e.jsxs("p",{className:"question-count",children:["Вопрос ",b+1," из ",((L=c==null?void 0:c.questions)==null?void 0:L.length)||0]}),e.jsx("h2",{dangerouslySetInnerHTML:{__html:m==null?void 0:m.text}}),(m==null?void 0:m.type)==="text"?e.jsxs("div",{className:"quiz-text-answer",children:[e.jsx("textarea",{value:y,onChange:K,placeholder:"Введите ваш ответ...",disabled:k,maxLength:512,rows:4}),e.jsxs("div",{className:"text-answer-counter",children:[y.length,"/512 символов"]})]}):e.jsx("div",{className:"quiz-answers",children:(B=m==null?void 0:m.answers)==null?void 0:B.map(n=>{const i=j===n.id,l=k?n.correct?"correct":i?"incorrect":"":"";return e.jsxs("label",{className:`quiz-answer ${l}`,children:[e.jsx("input",{type:"radio",name:"answer",checked:i,onChange:()=>Y(n.id),disabled:k}),n.text]},n.id)})})]})]}),e.jsx("div",{className:"actions",children:k?e.jsx("button",{className:`btn btn-p12 ${W?"btn-correct":"btn-incorrect"}`,onClick:tt,children:W?"Правильно! К следующему":"Неправильно! К следующему"}):e.jsx("button",{className:"btn btn-p12",onClick:Z,disabled:(m==null?void 0:m.type)==="text"?!y.trim():j==null,children:"Проверить"})})]})})}export{kt as default};
